var gmb_data,gmb_upload_marker,trafficLayer=new google.maps.TrafficLayer,transitLayer=new google.maps.TransitLayer,bicycleLayer=new google.maps.BicyclingLayer,placeSearchAutocomplete;!function(e,t){"use strict";e(window).on("load",function(){e(".cmb2-id-gmb-layers input").on("change",function(){t.set_map_layers(e(this))}),e(".cmb2-id-gmb-layers input:checkbox").each(function(){t.set_map_layers(e(this))});var a=e(".cmb2-id-gmb-places-search input");a.on("change",function(){t.toggle_map_places_search_field(e(this))}),t.toggle_map_places_search_field(a),t.set_map_goto_location_autocomplete(),t.set_map_edit_title(),google.maps.event.addListener(map,"drag",function(){t.set_toolbar_lat_lng()}),google.maps.event.addListener(map,"dragend",function(){t.set_toolbar_lat_lng()}),google.maps.event.addListener(map,"zoom_changed",function(){t.set_toolbar_lat_lng()}),e("body").on("click",".gmb-magnific-inline",function(a){a.preventDefault();var o="."+e(this).data("target"),n=e(this).data("auto-focus");if(e.magnificPopup.instance.isOpen===!0){e(o).before('<div class="modal-placeholder"></div>').removeClass("mfp-hide").appendTo(".magnific-builder #poststuff");var i=e(o).find(".inner-modal-wrap"),l=e(o).find(".inner-modal-container");0==i.length&&0==l.length&&(e(o).addClass("white-popup").wrapInner('<div class="inner-modal-wrap"><div class="inner-modal-container"><div class="inner-modal clear"></div></div></div>'),e('<button type="button" class="gmb-modal-close">&times;</button>').prependTo(e(o).find(".inner-modal"))),e(o).on("click",function(a){(e(a.target).hasClass("inner-modal-wrap")||e(a.target).hasClass("inner-modal-container"))&&t.close_modal_within_modal(o)}),e(".gmb-modal-close").on("click",function(){t.close_modal_within_modal(o)}),1==n&&e(o).find('input[type="text"]').focus()}else e.magnificPopup.open({callbacks:{beforeOpen:function(){e(o).addClass("white-popup")}},items:{src:e(o),type:"inline"},midClick:!0})}),gmb_upload_marker={uploader:function(){var e=wp.media({title:"Set an Custom Marker Icon",multiple:!1,library:{type:"image"},button:{text:"Set Marker"}});return e.on("close",function(){var t=e.state().get("selection").toJSON();gmb_upload_marker.render(t[0])}),e.open(),!1},render:function(t){e(".gmb-image-preview").prepend(gmb_upload_marker.imgHTML(t)),e(".gmb-image-preview").html(gmb_upload_marker.imgHTML(t)),e(".gmb-image-preview").show(),e(".save-marker-icon").slideDown(),e(".save-marker-button").data("marker-image",t.url)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',""!=e.alt&&(t+='alt="'+e.alt+'" '),t+="/>"},removeImage:function(t){e("#"+t+"attachment_id").val(""),e("#"+t+"imageurl").val(""),e("#"+t+"preview img").remove(),e("#"+t+"preview a").hide()}}}),t.set_map_layers=function(e){if(!e)return!1;var t=e.val(),a=e.prop("checked");switch(t){case"traffic":a?trafficLayer.setMap(window.map):trafficLayer.setMap(null);break;case"transit":a?transitLayer.setMap(window.map):transitLayer.setMap(null);break;case"bicycle":a?bicycleLayer.setMap(window.map):bicycleLayer.setMap(null)}},t.toggle_map_places_search_field=function(a){"undefined"==typeof placeSearchAutocomplete&&a.prop("checked")===!0?(t.set_map_places_search_field(),e("#places-search").show()):a.prop("checked")===!0&&"object"==typeof placeSearchAutocomplete?e("#places-search").show():e("#places-search").hide()},t.set_map_places_search_field=function(){function e(e,t){var a=document.getElementById(e);google.maps.event.addDomListener(a,"click",function(){placeSearchAutocomplete.setTypes(t)})}var t=document.getElementById("pac-input");document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("places-search")),placeSearchAutocomplete=new google.maps.places.Autocomplete(t),placeSearchAutocomplete.bindTo("bounds",map);var a=new google.maps.InfoWindow,o=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,(-29))});google.maps.event.addListener(placeSearchAutocomplete,"place_changed",function(){a.close(),o.setVisible(!1);var e=placeSearchAutocomplete.getPlace();if(!e.geometry)return void window.alert("Autocomplete's returned place contains no geometry");e.geometry.viewport?map.fitBounds(e.geometry.viewport):(map.setCenter(e.geometry.location),map.setZoom(17)),o.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),o.setPosition(e.geometry.location),o.setVisible(!0);var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),a.setContent("<div><strong>"+e.name+"</strong><br>"+t),a.open(map,o)}),e("changetype-all",[]),e("changetype-address",["address"]),e("changetype-establishment",["establishment"]),e("changetype-geocode",["geocode"]),google.maps.event.addDomListener(t,"keydown",function(e){13==e.keyCode&&e.preventDefault()})},t.set_map_goto_location_autocomplete=function(){var a=e(".map-autocomplete-wrap"),o=e("#map-location-autocomplete").get(0),n=new google.maps.places.Autocomplete(o);n.bindTo("bounds",map),google.maps.event.addListener(n,"place_changed",function(){var o=n.getPlace();return o.geometry?(o.geometry.viewport?map.fitBounds(o.geometry.viewport):(map.setCenter(o.geometry.location),map.setZoom(17)),e(a).find(".mfp-close").trigger("click"),void t.close_modal_within_modal(a)):void window.alert("Autocomplete's returned place contains no geometry")}),google.maps.event.addDomListener(o,"keydown",function(e){13==e.keyCode&&e.preventDefault()})},t.close_modal_within_modal=function(t){e(t).addClass("mfp-hide").appendTo(".modal-placeholder").unwrap()},t.set_map_edit_title=function(){e(".edit-title").on("click",function(){e("#modal_title").val(e("input#title").val()).focus()}),e("#modal_title").on("blur",function(){e("input#title").val(e(this).val())})},t.set_toolbar_lat_lng=function(){var t=e(".lat-lng-update-btn"),a=e(".update-lat-lng"),o=map.getCenter();e(".live-latitude").text(o.lat()),e(".live-longitude").text(o.lng()),a.attr("data-lat",o.lat()),e(".lat-lng-change-message").slideDown(),a.attr("data-lng",o.lng()),t.attr("data-lat",o.lat()),t.attr("data-lng",o.lng()),t.removeAttr("disabled"),a.removeAttr("disabled")}}(jQuery,window.MapsBuilderAdmin||(window.MapsBuilderAdmin={}));